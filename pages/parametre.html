<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Liste des clients</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#ED7B01',
            darkblue: '#1C236B'
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif']
          }
        }
      }
    };
  </script>
</head>

<body class="bg-gray-100 font-sans">
  <div id="header"></div>
  <div id="navbar"></div>
  <main class="sm:pl-64 pt-[112px] px-6">
    <div class="max-w-2xl mx-auto space-y-10">
      <!-- Section Infos -->
      <section class="border border-gray-200 bg-white rounded-xl shadow-sm p-6">
        <h2 class="text-xl font-semibold text-darkblue mb-4 border-b pb-2">Modifier les informations</h2>
        <form id="user-settings-form" class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
          <div>
            <label class="block mb-1 text-gray-700">Prénom</label>
            <input type="text" id="first_name" name="first_name"
              class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-1 focus:ring-primary">
          </div>
          <div>
            <label class="block mb-1 text-gray-700">Nom</label>
            <input type="text" id="last_name" name="last_name"
              class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-1 focus:ring-primary">
          </div>
          <div>
            <label class="block mb-1 text-gray-700">Email</label>
            <input type="email" id="email" name="email"
              class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-1 focus:ring-primary">
          </div>
          <div>
            <label class="block mb-1 text-gray-700">Téléphone</label>
            <input type="text" id="phone" name="phone"
              class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-1 focus:ring-primary">
          </div>
          <div>
            <label class="block mb-1 text-gray-700">Sexe</label>
            <select id="sexe" name="sexe"
              class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-1 focus:ring-primary">
              <option value="homme">Homme</option>
              <option value="femme">Femme</option>
            </select>
          </div>
          <div class="sm:col-span-2">
            <label class="block mb-1 text-gray-700">Adresse</label>
            <input type="text" id="adresse" name="adresse"
              class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-1 focus:ring-primary">
          </div>
          <div class="sm:col-span-2 text-right pt-2">
            <button type="submit"
              class="bg-primary hover:bg-orange-700 text-white font-semibold px-5 py-2 rounded-md shadow transition">
              💾 Enregistrer
            </button>
          </div>
        </form>
      </section>


    </div>
  </main>


  <script type="module">
    import { loadNavbar } from '/assets/js/navbar.js';
    import { loadHeader } from '/assets/js/header.js';
    import { getClients, authFetch } from '/assets/js/api.js';
    import { renderTable } from '/assets/js/table.js';
    import { injectButton, guardAccess } from '/assets/js/utils.js';
    import { showNotification } from "/assets/js/notificationModal.js";

    loadNavbar();
    loadHeader();

    // 🔐 1. Récupère les infos de l'utilisateur connecté et pré-remplit le formulaire
    authFetch("http://127.0.0.1:8000/accounts/me/")
      .then(res => res.json())
      .then(user => {
        document.getElementById('first_name').value = user.first_name || '';
        document.getElementById('last_name').value = user.last_name || '';
        document.getElementById('email').value = user.email || '';
        document.getElementById('phone').value = user.telephone || '';
        document.getElementById('adresse').value = user.adresse || '';
        document.getElementById('sexe').value = user.sexe || '';
      });

    // 🧾 2. Lors du submit, on met à jour les infos via PATCH
    document.getElementById('user-settings-form').addEventListener('submit', function (e) {
      e.preventDefault();

      const formData = {
        first_name: document.getElementById('first_name').value,
        last_name: document.getElementById('last_name').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        adresse: document.getElementById('adresse').value,
        sexe: document.getElementById('sexe').value,
      };

      authFetch("http://127.0.0.1:8000/accounts/update/", {
        method: "PATCH",
        body: JSON.stringify(formData)
      })
        .then(res => {
          if (res.ok) {
            showNotification("Informations mises à jour !");
            location.reload();
          } else {
            showNotification("Une erreur s’est produite.");
          }
        });
    });


  </script>
</body>

</html>